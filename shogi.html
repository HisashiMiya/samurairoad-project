<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>the Shogi(極み将棋) H.M.C</title>
<link rel="stylesheet" href="./assets/css/base.css">
<link rel="stylesheet" href="./assets/css/shogi.css?v=20260117-2">
<link rel="stylesheet" href="./assets/css/shogi-app.css">
<link rel="stylesheet" href="./assets/css/mobile.css">
</head>
<body>

  <!-- Mobile Menu -->
  <div id="mobileMenuBtn"><button class="btn primary" type="button">メニュー</button></div>
  <div id="mobileDrawer" aria-hidden="true">
    <div class="panel">
      <div class="tabs">
        <button class="btn" id="tabSettings" type="button">設定</button>
        <button class="btn" id="tabKifu" type="button">棋譜</button>
        <a class="btn" id="tabHelp" href="./shogihelp.html" target="_blank" rel="noopener">ヘルプ</a>
        <button class="btn ghost closeBtn" id="btnDrawerClose" type="button">×</button>
      </div>

      <div id="drawerSettings" class="drawerSection">
        <div class="card" id="settingsPanel">
          <h1>設定</h1>
          <div class="muted" style="margin-bottom:8px">スマホの制限により、音は最初のタップ後に有効になります。</div>
          <div class="row">
            <label class="small" style="display:flex;align-items:center;gap:8px">
              <input type="checkbox" id="chkAudio" checked> 音：ON
            </label>
          </div>
          <div class="row">
            <label class="small" style="display:flex;align-items:center;gap:8px">
              <input type="checkbox" id="chkVibe" checked> 振動：ON
            </label>
          </div>
        </div>
      </div>

      <div id="drawerKifu" class="drawerSection">
        <div id="drawerKifuHost"></div>
      </div>
    </div>
  </div>

  
  <!-- UI Modal (no browser alert/confirm) -->
  <div id="uiModal">
    <div class="uiModalContent">
      <div id="uiModalMsg" style="line-height:1.7"></div>
      <div class="row" style="margin-top:12px;justify-content:flex-end;gap:8px">
        <button class="btn ghost" id="uiModalCancel" type="button" style="display:none">キャンセル</button>
        <button class="btn primary" id="uiModalOk" type="button">OK</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <section class="card" id="gamePanel">
      <h1>極み将棋</h1>
      <p class="muted">
        URLの <code>#room=xxxx</code> を共有すると同じ部屋に入れます。<br>
      </p>

      <div class="row" style="margin:10px 0">
        <input id="name" class="input" style="max-width:220px" placeholder="名前" />
        <button class="btn primary" id="btnConnect">接続</button>
        <button class="btn" id="btnCopyUrl">部屋コピー</button>
        <button class="btn" id="btnReset">リセット</button>
        <button class="btn" id="btnFull">⛶ 全画面</button>
        <button class="btn chatToggle" id="btnChatToggle">💬 チャット</button>
        <button class="btn ghost" id="btnSound">🔊 音: ON</button>
      </div>
<div class="status" id="status">未接続</div>

      <div class="row" style="margin:10px 0 12px">
        <span class="badge turnBig" id="turnBadge"><span class="dot"></span><span id="turnText">手番: -</span></span>
      </div>
<div class="hand">
            <div class="handTitle"><span>相手の持ち駒</span><span class="small" id="handHintG"></span></div>
            <div class="handPieces" id="handG"></div>
          </div>

      <div style="margin-top:12px">
        <div id="board" aria-label="shogi-board"></div>

        <div class="hands">
          
          <div class="hand">
            <div class="handTitle"><span>自分の持ち駒</span><span class="small" id="handHintS"></span></div>
            <div class="handPieces" id="handS"></div>
          </div>
        </div>
        <div class="hint">
          ・持ち駒は <b>自分の手番</b>のときだけ選べます（選択→盤の空マスをクリックで打つ）。<br>
          ・盤の駒を選択→移動先クリックで動かします。<br>
        </div>
      </div>
    </section>

    
    <div id="kifuDock"></div>
    <aside class="card" id="kifuPanel">
  <div class="kifuHeader">
    <h1>棋譜</h1>
    <div class="kifuNav" aria-label="kifu-nav">
      <button class="btn" id="btnKifuPrev">◀ 前へ</button>
      <button class="btn" id="btnKifuNext">次へ ▶</button>
      <span class="small" id="kifuStep">手数 0 / 0</span>
    </div>
  </div>
<div class="row" style="margin-top:10px">
        <textarea id="kifuText" class="input" style="min-height:140px;resize:vertical" placeholder="ここに棋譜JSONを貼り付け（インポート用）"></textarea>
      </div>
      <p class="small"></p>
    </aside>


    <aside class="card" id="chatPanel">
      <h1>チャット</h1>
      <div class="chatLog" id="chatLog"></div>
      <div class="chatComposer">
      <div class="row" style="margin-top:0">
        <input id="chatInput" class="input" placeholder="メッセージ…" />
      </div>
      <div class="row" style="margin-top:10px">
        <button class="btn primary" id="btnSend">送信</button>
      </div>
      </div>
      <p class="small">※観戦者もチャット可能。対局は先着2人がプレイヤーになります（MVPのため強制は未実装）。</p>
    </aside>
  </div>
</div>
<details class="card" id="devMemo">
  <summary>🛠 開発者メモ</summary>
  <div class="muted" style="font-size:.92rem;line-height:1.65; margin-top:10px">
  <div class="muted" style="font-size:.92rem;line-height:1.65">
    <div>MVP：合法手・王手判定・打ち歩詰め等は未対応（ただし「二歩」「行き所のない駒の打ち」は最低限ガード）。</div>
    <div>成りは実装済み（成れる場合は確認、強制成りも対応）。</div>
    <div>・持ち駒は <b>自分の手番</b>のときだけ選べます（選択→盤の空マスをクリックで打つ）。</div>
    <div>・盤の駒を選択→移動先クリックで動かします。</div>
    <div>・王が取られたら勝敗表示（ポップアップ表示）。</div>
    <div>・通信基盤は変更なし（Worker/DOは中継・同期・保存のみ）。</div>
    <div>・AIによる次の最善手解析（設計案）：まずは「現局面をテキスト化→解析用プロンプト生成→コピーしてAIに貼る」方式（超安全）。次段階でWorkers経由のAPI連携、さらに将棋エンジン/WASM化へ拡張。</div>
    <div>・棋譜：自動取得ONのとき、指し手ごとにローカル保存（localStorage）します。</div>
  </div>
</details>


<div id="aiResultModal">
  <div class="ai-content">
    <div id="aiResultBody"></div>
    <div class="row" style="justify-content:flex-end; margin-top:20px;">
      <button class="btn" id="btnAiResultClose" type="button">閉じる</button>
    </div>
  </div>
</div>
  <!-- Footer include mount point -->
  <div data-include="/includes/footer.html" aria-label="Footer"></div>

  <script src="./assets/js/shogi-config.js?v=20260118" defer></script>
  <script src="./assets/js/shogi-core.js?v=20260118" defer></script>
</body>
</html>

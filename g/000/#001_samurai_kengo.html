<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>SAMURAI DIE: 剣豪</title>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@700;900&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@900&display=swap');

    :root {
        --bg: #050505;
        --ui-bg: rgba(20, 20, 20, 0.9);
        --paper: #f0e6d2;
        --blood: #e7000b;
        --gold: #c5a059;
        --shadow: rgba(0,0,0,0.8);
        --font-jp: 'Noto Serif JP', serif;
        --font-en: 'Cinzel', serif;
    }

    body {
        background: var(--bg);
        color: var(--paper);
        font-family: var(--font-jp);
        margin: 0;
        padding: 0;
        height: 100vh;
        overflow: hidden;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
        display: flex;
        flex-direction: column;
    }

    /* 3D空間の定義 */
    .scene {
        position: relative;
        flex: 1;
        perspective: 1000px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: radial-gradient(circle, #222 0%, #000 90%);
        z-index: 1;
    }

    /* 背景のエフェクト */
    .vignette {
        position: absolute; inset: 0;
        box-shadow: inset 0 0 150px #000;
        pointer-events: none;
        z-index: 2;
    }

    /* UIレイヤー */
    .ui-layer {
        position: absolute; inset: 0;
        pointer-events: none;
        z-index: 10;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 20px;
    }
    .ui-top { display: flex; justify-content: space-between; align-items: flex-start; }
    .ui-bottom { display: flex; justify-content: center; padding-bottom: 20px; pointer-events: auto; }

    /* ステータスバー */
    .stat-badge {
        background: var(--ui-bg);
        border: 2px solid var(--gold);
        padding: 5px 15px;
        border-radius: 4px;
        box-shadow: 0 4px 10px var(--shadow);
        pointer-events: auto;
    }
    .stat-label { font-size: 10px; color: #888; text-transform: uppercase; letter-spacing: 1px; }
    .stat-val { font-size: 24px; font-weight: 900; color: var(--paper); }
    .hp-text { color: var(--blood); text-shadow: 0 0 5px var(--blood); }

    /* 敵情報 */
    .enemy-info {
        position: absolute;
        top: 15%;
        width: 100%;
        text-align: center;
        z-index: 5;
        pointer-events: none;
        transition: transform 0.3s, opacity 0.3s;
    }
    .enemy-name {
        font-size: 42px; font-weight: 900;
        text-shadow: 0 0 20px #000;
        letter-spacing: 0.2em;
        margin-bottom: 5px;
    }
    .enemy-cond {
        background: var(--blood);
        color: #fff;
        padding: 2px 12px;
        font-size: 14px;
        display: inline-block;
        box-shadow: 0 0 10px var(--blood);
        font-family: var(--font-en);
    }
    
    /* 3Dダイスコンテナ */
    .dice-table {
        display: flex;
        gap: 20px;
        transform-style: preserve-3d;
        margin-top: 50px;
    }

    /* 3Dキューブ */
    .cube {
        width: 80px; height: 80px;
        position: relative;
        transform-style: preserve-3d;
        transform: rotateX(0deg) rotateY(0deg);
        transition: transform 0.5s cubic-bezier(0.2, 0.8, 0.2, 1.2);
        cursor: pointer;
    }
    .cube.rolling {
        animation: spin 0.6s linear infinite;
    }
    @keyframes spin {
        0% { transform: rotateX(0) rotateY(0) rotateZ(0); }
        100% { transform: rotateX(360deg) rotateY(720deg) rotateZ(360deg); }
    }

    .face {
        position: absolute;
        width: 80px; height: 80px;
        background: #eee;
        border: 2px solid #ccc;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 40px;
        color: #111;
        box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
        backface-visibility: hidden;
        font-weight: bold;
    }
    /* 漢数字フォント */
    .face { font-family: "HiraMinProN-W6", serif; }

    /* サイコロの面の配置 */
    .face.front  { transform: rotateY(0deg) translateZ(40px); }
    .face.back   { transform: rotateY(180deg) translateZ(40px); }
    .face.right  { transform: rotateY(90deg) translateZ(40px); }
    .face.left   { transform: rotateY(-90deg) translateZ(40px); }
    .face.top    { transform: rotateX(90deg) translateZ(40px); }
    .face.bottom { transform: rotateX(-90deg) translateZ(40px); }

    /* ロック状態 */
    .cube.locked .face {
        background: #333;
        color: #888;
        border-color: var(--gold);
        box-shadow: inset 0 0 15px #000;
    }
    .cube.locked::after {
        content: 'LOCK';
        position: absolute; top: -20px; left: 50%;
        transform: translateX(-50%);
        font-size: 12px; color: var(--gold);
        font-family: var(--font-en);
        text-shadow: 0 0 5px var(--gold);
    }

    /* スキルボタン (ダイスの下に表示) */
    .skill-btn {
        position: absolute; bottom: -40px; left: 50%;
        transform: translateX(-50%);
        background: #222; border: 1px solid #666; color: #fff;
        font-size: 10px; padding: 4px 8px; border-radius: 4px;
        white-space: nowrap; cursor: pointer;
        opacity: 0; pointer-events: none; transition: opacity 0.2s;
    }
    .cube:hover .skill-btn { opacity: 1; pointer-events: auto; }

    /* 操作ボタン */
    .btn-main {
        background: transparent;
        border: 2px solid var(--paper);
        color: var(--paper);
        font-family: var(--font-jp);
        font-size: 22px;
        font-weight: 900;
        padding: 15px 50px;
        cursor: pointer;
        position: relative;
        overflow: hidden;
        transition: all 0.2s;
        text-shadow: 0 2px 0 #000;
    }
    .btn-main::before {
        content: ''; position: absolute; inset: 0;
        background: var(--paper); opacity: 0; transition: opacity 0.2s;
    }
    .btn-main:active { transform: scale(0.95); }
    .btn-main:active::before { opacity: 0.2; }

    .cost-badge {
        position: absolute; right: 5px; bottom: 2px;
        font-size: 10px; color: var(--blood);
        font-weight: 700;
    }

    /* 一閃ボタン（必殺） */
    #btn-issen {
        display: none;
        border-color: var(--blood);
        color: #fff;
        background: var(--blood);
        box-shadow: 0 0 30px var(--blood);
        animation: heartbeat 1s infinite;
        font-size: 32px; letter-spacing: 5px;
    }
    @keyframes heartbeat { 0%{transform:scale(1);} 50%{transform:scale(1.05);} 100%{transform:scale(1);} }

    /* 斬撃エフェクト & パーティクル */
    #canvas-fx {
        position: fixed; inset: 0;
        pointer-events: none;
        z-index: 100;
    }
    #flash-overlay {
        position: fixed; inset: 0;
        background: #fff; opacity: 0;
        pointer-events: none; z-index: 90;
        transition: opacity 0.1s;
    }

    /* レベルアップ（スキル選択）画面 */
    #levelup-modal {
        position: fixed; inset: 0;
        background: rgba(0,0,0,0.95);
        z-index: 200;
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
    }
    .scroll-container {
        display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;
        margin-top: 30px;
    }
    .scroll-card {
        width: 140px; height: 180px;
        background: var(--paper);
        color: #000;
        padding: 15px;
        border: 4px double #555;
        text-align: center;
        cursor: pointer;
        transition: transform 0.2s;
        display: flex; flex-direction: column; justify-content: space-between;
    }
    .scroll-card:active { transform: scale(0.95); background: #fff; }
    .scroll-title { font-weight: 900; font-size: 18px; margin-bottom: 10px; border-bottom: 2px solid #000; }
    .scroll-desc { font-size: 12px; line-height: 1.4; }

    /* スタート画面 / ゲームオーバー */
    #title-screen, #dead-screen {
        position: fixed; inset: 0; background: #000; z-index: 300;
        display: flex; flex-direction: column;
        align-items: center; justify-content: center;
    }
    h1 { font-size: 48px; margin: 0; color: var(--paper); letter-spacing: 0.2em; text-align: center; }
    .sub { font-size: 16px; color: var(--gold); margin-bottom: 40px; font-family: var(--font-en); }

    /* 設定ボタン */
    .cfg-btn {
        background: #333; border: 1px solid #666; color: #aaa;
        padding: 5px 10px; border-radius: 4px; cursor: pointer;
    }
    .cfg-btn.active { border-color: var(--gold); color: var(--gold); }

</style>
</head>
<body>

<canvas id="canvas-fx"></canvas>
<div id="flash-overlay"></div>
<div class="vignette"></div>

<div class="ui-layer">
    <div class="ui-top">
        <div class="stat-badge">
            <div class="stat-label">RANK</div>
            <div class="stat-val">Lv.<span id="ui-lvl">1</span></div>
        </div>
        <div class="stat-badge" style="border-color:var(--blood)">
            <div class="stat-label">LIFE</div>
            <div class="stat-val hp-text"><span id="ui-hp">10</span>/<span id="ui-maxhp">10</span></div>
        </div>
        <div style="position:absolute; top:20px; right:20px; display:flex; gap:5px; pointer-events:auto;">
            <button class="cfg-btn" id="btn-lang" onclick="toggleLang()">EN</button>
            <button class="cfg-btn active" id="btn-sound" onclick="toggleSound()">♪</button>
        </div>
    </div>

    <div class="ui-bottom">
        <button class="btn-main" id="btn-roll" onclick="actionRoll()">
            <span data-key="kiai">気合</span>
            <div class="cost-badge">-1 HP</div>
        </button>
        <button class="btn-main" id="btn-issen" onclick="actionIssen()">
            <span data-key="issen">一閃</span>
        </button>
    </div>
</div>

<div class="scene">
    <div class="enemy-info" id="enemy-info">
        <div class="enemy-name" id="ui-ename">野武士</div>
        <div class="enemy-cond" id="ui-econd">ANY PAIR</div>
    </div>

    <div class="dice-table" id="dice-table">
        </div>
</div>

<div id="title-screen">
    <h1>侍賽</h1>
    <div class="sub">SAMURAI DIE: KENGO</div>
    <button class="btn-main" onclick="startGame()" style="border-color:var(--gold); color:var(--gold);">いざ (START)</button>
</div>

<div id="dead-screen" style="display:none;">
    <h1 style="color:var(--blood)">死</h1>
    <div class="sub">DEATH AT Lv.<span id="dead-lvl">1</span></div>
    <button class="btn-main" onclick="location.reload()">転生 (RETRY)</button>
</div>

<div id="levelup-modal">
    <h2 style="color:var(--gold)">奥義開眼</h2>
    <div class="sub">CHOOSE A SECRET ART</div>
    <div class="scroll-container" id="scroll-list">
        </div>
</div>

<script>
    // --- 言語データ ---
    const DICT = {
        ja: {
            kiai: "気合 (振直)",
            issen: "一閃",
            // 敵
            e_thug: "野盗", e_ronin: "浪人", e_general: "大将", e_master: "剣豪", e_demon: "阿修羅",
            c_pair: "ゾロ目 (PAIR)", c_pair_n: "{N}のゾロ目", c_trip: "三連 (TRIPLE)", c_str: "連番 (STRAIGHT)",
            // スキル
            s_heal_t: "薬湯", s_heal_d: "HPを3回復する",
            s_maxhp_t: "金剛身", s_maxhp_d: "最大HP+2",
            s_reroll_t: "無心", s_reroll_d: "次の振直コスト0",
            s_fix1_t: "壱ノ型", s_fix1_d: "ダイス1つを[壱]にする",
            s_fix6_t: "六ノ型", s_fix6_d: "ダイス1つを[六]にする"
        },
        en: {
            kiai: "REROLL",
            issen: "SLASH",
            e_thug: "THUG", e_ronin: "RONIN", e_general: "GENERAL", e_master: "MASTER", e_demon: "ASHURA",
            c_pair: "ANY PAIR", c_pair_n: "PAIR OF {N}", c_trip: "TRIPLE", c_str: "STRAIGHT",
            s_heal_t: "MEDICINE", s_heal_d: "Heal 3 HP",
            s_maxhp_t: "IRON BODY", s_maxhp_d: "Max HP +2",
            s_reroll_t: "ZEN MIND", s_reroll_d: "Next reroll cost 0",
            s_fix1_t: "FORM: I", s_fix1_d: "Set a die to [1]",
            s_fix6_t: "FORM: VI", s_fix6_d: "Set a die to [6]"
        }
    };
    
    // --- システム変数 ---
    let cfg = { lang: 'ja', sound: true };
    let state = {
        lvl: 1, hp: 10, maxHp: 10, xp: 0, nextXp: 3,
        dice: [1,2,3], locks: [false, false, false],
        enemy: null,
        skills: [], // 所持スキル
        freeRoll: false // スキル効果
    };
    
    const KANJI = ["", "壱", "弐", "参", "四", "伍", "六"];
    const ROMAN = ["", "I", "II", "III", "IV", "V", "VI"];

    // --- Audio System (Web Audio API) ---
    const actx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playSnd(type) {
        if(!cfg.sound) return;
        if(actx.state === 'suspended') actx.resume();
        const t = actx.currentTime;
        
        const osc = actx.createOscillator();
        const gain = actx.createGain();
        osc.connect(gain);
        gain.connect(actx.destination);

        switch(type) {
            case 'roll': // ガラガラ
                for(let i=0; i<3; i++){
                    let o = actx.createOscillator();
                    let g = actx.createGain();
                    o.connect(g); g.connect(actx.destination);
                    o.type = 'square'; o.frequency.value = 50 + Math.random()*100;
                    g.gain.setValueAtTime(0.05, t); g.gain.linearRampToValueAtTime(0, t+0.1);
                    o.start(t + Math.random()*0.1); o.stop(t+0.2);
                }
                break;
            case 'lock': // カッ
                osc.frequency.setValueAtTime(800, t);
                osc.frequency.exponentialRampToValueAtTime(100, t+0.05);
                gain.gain.setValueAtTime(0.3, t);
                gain.gain.linearRampToValueAtTime(0, t+0.05);
                osc.start(t); osc.stop(t+0.05);
                break;
            case 'slash': // ズバァァ
                const buf = actx.createBuffer(1, actx.sampleRate*0.5, actx.sampleRate);
                const d = buf.getChannelData(0);
                for(let i=0;i<d.length;i++) d[i] = Math.random()*2-1;
                const src = actx.createBufferSource();
                src.buffer = buf;
                const f = actx.createBiquadFilter();
                f.type = 'lowpass';
                f.frequency.setValueAtTime(5000, t);
                f.frequency.exponentialRampToValueAtTime(100, t+0.3);
                src.connect(f); f.connect(gain);
                gain.connect(actx.destination);
                gain.gain.setValueAtTime(1, t);
                gain.gain.exponentialRampToValueAtTime(0.01, t+0.3);
                src.start(t);
                break;
            case 'win': // キンッ（納刀）
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(1200, t);
                gain.gain.setValueAtTime(0.1, t);
                gain.gain.exponentialRampToValueAtTime(0.001, t+1);
                osc.start(t); osc.stop(t+1);
                break;
        }
    }

    // --- 3D Dice Logic ---
    function createDice() {
        const table = document.getElementById('dice-table');
        table.innerHTML = "";
        for(let i=0; i<3; i++) {
            const cube = document.createElement('div');
            cube.className = 'cube';
            cube.onclick = () => toggleLock(i);
            // 6面作成
            for(let f=1; f<=6; f++) {
                const face = document.createElement('div');
                let className = ['','front','back','right','left','top','bottom'][f];
                face.className = `face ${className}`;
                face.textContent = (cfg.lang === 'ja') ? KANJI[f] : f;
                cube.appendChild(face);
            }
            
            // スキルボタン（壱にする等）
            const sBtn = document.createElement('div');
            sBtn.className = 'skill-btn';
            sBtn.textContent = "SET 6"; // テスト用
            sBtn.style.display = 'none'; // 通常は非表示
            cube.appendChild(sBtn);

            table.appendChild(cube);
        }
        updateDiceVisuals();
    }

    function updateDiceVisuals() {
        const cubes = document.querySelectorAll('.cube');
        cubes.forEach((c, i) => {
            const val = state.dice[i];
            const locked = state.locks[i];
            
            // 回転計算
            // 1:0,0 | 2:0,180 | 3:0,-90 | 4:0,90 | 5:-90,0 | 6:90,0
            const rots = [
                [0,0], [0,0], [0,180], [0,-90], [0,90], [-90,0], [90,0]
            ];
            const r = rots[val];
            
            // 回転アニメーションのため、ランダムに回転数を足す
            // すでに回っている場合はそこから追加
            c.style.transform = `rotateX(${r[0]}deg) rotateY(${r[1]}deg)`;
            
            if(locked) c.classList.add('locked');
            else c.classList.remove('locked');

            // 面の文字更新
            const faces = c.querySelectorAll('.face');
            faces.forEach((f, idx) => {
                f.textContent = (cfg.lang==='ja') ? KANJI[idx+1] : (idx+1);
            });
        });
    }

    function animRoll() {
        playSnd('roll');
        const cubes = document.querySelectorAll('.cube');
        cubes.forEach((c, i) => {
            if(!state.locks[i]) {
                // 激しく回転させる
                const rx = Math.random() * 720 + 360;
                const ry = Math.random() * 720 + 360;
                c.style.transition = "transform 0.4s ease-out";
                c.style.transform = `rotateX(${rx}deg) rotateY(${ry}deg)`;
            }
        });
    }

    // --- Particle System ---
    const canvas = document.getElementById('canvas-fx');
    const ctx = canvas.getContext('2d');
    let particles = [];
    
    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.onresize = resizeCanvas;
    resizeCanvas();

    function spawnBlood() {
        for(let i=0; i<30; i++) {
            particles.push({
                x: window.innerWidth/2, y: window.innerHeight/2,
                vx: (Math.random()-0.5)*20, vy: (Math.random()-0.5)*20,
                life: 1.0, size: Math.random()*20 + 5, color: '#aa0000'
            });
        }
    }

    function updateParticles() {
        ctx.clearRect(0,0, canvas.width, canvas.height);
        particles.forEach((p, i) => {
            p.x += p.vx; p.y += p.vy;
            p.vy += 0.5; // gravity
            p.life -= 0.02;
            p.size *= 0.95;
            
            ctx.fillStyle = p.color;
            ctx.globalAlpha = p.life;
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
            ctx.fill();
            
            if(p.life <= 0) particles.splice(i, 1);
        });
        requestAnimationFrame(updateParticles);
    }
    updateParticles();

    // --- Game Logic ---

    function t(k) { return DICT[cfg.lang][k] || k; }

    function toggleLang() {
        cfg.lang = (cfg.lang==='ja') ? 'en' : 'ja';
        document.getElementById('btn-lang').textContent = cfg.lang.toUpperCase();
        createDice();
        updateUI();
    }
    function toggleSound() {
        cfg.sound = !cfg.sound;
        document.getElementById('btn-sound').classList.toggle('active', cfg.sound);
        if(cfg.sound) actx.resume();
    }

    function startGame() {
        document.getElementById('title-screen').style.display = 'none';
        createDice();
        spawnEnemy();
        updateUI();
    }

    function spawnEnemy() {
        // 敵生成
        const types = ["thug", "ronin", "general", "master", "demon"];
        const lvlIdx = Math.min(Math.floor(state.lvl/3), 4);
        const type = types[lvlIdx]; // 簡易ロジック
        
        let mode = "pair";
        let target = 0;
        
        // 敵タイプによるモード決定
        if(type === 'thug') { mode="pair"; }
        else if(type === 'ronin') { mode="pair_n"; target = Math.floor(Math.random()*6)+1; }
        else if(type === 'general') { mode="trip"; }
        else if(type === 'master') { mode="trip_n"; target = Math.floor(Math.random()*6)+1; }
        else { mode="str"; }

        state.enemy = { type, mode, target };
        state.locks = [false, false, false];
        
        // 無料ロール
        rollLogic(true);
        updateUI();
    }

    function rollLogic(free) {
        state.dice = state.dice.map((v, i) => state.locks[i] ? v : Math.floor(Math.random()*6)+1);
        
        // 3D更新
        updateDiceVisuals();
        
        // 判定
        checkWin();
    }

    function actionRoll() {
        if(state.hp <= 1 && !state.freeRoll) {
            // ゲームオーバー処理
            document.getElementById('dead-lvl').textContent = state.lvl;
            document.getElementById('dead-screen').style.display = 'flex';
            playSnd('dead'); // 重低音
            return;
        }

        // コスト支払い
        if(!state.freeRoll) state.hp -= 1;
        state.freeRoll = false;

        animRoll();
        
        // アニメーション待ち
        setTimeout(() => {
            rollLogic(false);
            updateUI();
        }, 400);
    }

    function toggleLock(i) {
        playSnd('lock');
        state.locks[i] = !state.locks[i];
        updateDiceVisuals();
    }

    function checkWin() {
        const d = state.dice;
        const counts = {};
        d.forEach(v => counts[v] = (counts[v]||0)+1);
        const e = state.enemy;
        let win = false;

        if(e.mode === 'pair') win = Object.values(counts).some(c => c>=2);
        if(e.mode === 'pair_n') win = counts[e.target] >= 2;
        if(e.mode === 'trip') win = Object.values(counts).some(c => c>=3);
        if(e.mode === 'trip_n') win = counts[e.target] >= 3;
        if(e.mode === 'str') {
            const s = [...d].sort().join('');
            win = (s==="123" || s==="456");
        }

        const btnIss = document.getElementById('btn-issen');
        const btnRol = document.getElementById('btn-roll');
        
        if(win) {
            btnIss.style.display = 'block';
            btnRol.style.display = 'none';
            // 敵カードが揺れるなど
        } else {
            btnIss.style.display = 'none';
            btnRol.style.display = 'flex';
        }
    }

    function actionIssen() {
        playSnd('slash');
        playSnd('win');
        spawnBlood();
        
        // フラッシュ
        const fl = document.getElementById('flash-overlay');
        fl.style.opacity = 0.8;
        setTimeout(() => fl.style.opacity = 0, 100);

        // 報酬
        state.xp += 1;
        state.hp = Math.min(state.maxHp, state.hp + 1); // 1回復

        if(state.xp >= state.nextXp) {
            openLevelUp();
        } else {
            setTimeout(spawnEnemy, 1000);
        }
    }

    function openLevelUp() {
        state.lvl++;
        state.xp = 0;
        state.nextXp += 2;
        
        // スキル選択肢生成
        const opts = [
            {id:'heal', t:'s_heal_t', d:'s_heal_d'},
            {id:'maxhp', t:'s_maxhp_t', d:'s_maxhp_d'},
            {id:'reroll', t:'s_reroll_t', d:'s_reroll_d'}
        ];
        // ランダムに2つ選んでもいいが、今回は固定
        
        const c = document.getElementById('scroll-list');
        c.innerHTML = "";
        opts.forEach(o => {
            const card = document.createElement('div');
            card.className = 'scroll-card';
            card.innerHTML = `<div class="scroll-title">${t(o.t)}</div><div class="scroll-desc">${t(o.d)}</div>`;
            card.onclick = () => applySkill(o.id);
            c.appendChild(card);
        });

        document.getElementById('levelup-modal').style.display = 'flex';
    }

    function applySkill(id) {
        if(id === 'heal') state.hp = Math.min(state.maxHp, state.hp + 3);
        if(id === 'maxhp') { state.maxHp += 2; state.hp += 2; }
        if(id === 'reroll') state.freeRoll = true;
        
        document.getElementById('levelup-modal').style.display = 'none';
        setTimeout(spawnEnemy, 500);
        updateUI();
    }

    function updateUI() {
        document.getElementById('ui-lvl').textContent = state.lvl;
        document.getElementById('ui-hp').textContent = state.hp;
        document.getElementById('ui-maxhp').textContent = state.maxHp;
        
        if(state.enemy) {
            document.getElementById('ui-ename').textContent = t(state.enemy.key);
            let cText = t("c_" + state.enemy.mode);
            if(state.enemy.target) {
                const n = (cfg.lang==='ja') ? KANJI[state.enemy.target] : state.enemy.target;
                cText = t("c_" + state.enemy.mode).replace("{N}", n);
            }
            document.getElementById('ui-econd').textContent = cText;
        }

        // コスト表示
        const badge = document.querySelector('.cost-badge');
        if(state.freeRoll) {
            badge.textContent = "FREE";
            badge.style.color = "var(--gold)";
        } else {
            badge.textContent = "-1 HP";
            badge.style.color = "var(--blood)";
        }
    }

</script>
</body>
</html>
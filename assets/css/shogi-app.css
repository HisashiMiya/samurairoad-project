/*
  SamuraiRoad Shogi UI additions (extracted from inline styles)
*/

/* --- Mobile menu (minimal) --- */
#mobileMenuBtn{display:none;position:fixed;right:12px;bottom:12px;z-index:9999}
#mobileMenuBtn .btn{padding:.8rem 1rem;border-radius:999px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
#mobileDrawer{display:none;position:fixed;inset:0;z-index:9998;background:rgba(0,0,0,.55)}
#mobileDrawer .panel{position:absolute;right:0;top:0;height:100%;width:min(92vw,420px);background:rgba(17,26,51,.98);border-left:1px solid rgba(255,255,255,.12);padding:12px;overflow:auto}
#mobileDrawer .tabs{display:flex;gap:8px;align-items:center;margin-bottom:10px}
#mobileDrawer .tabs .btn{flex:1}
#mobileDrawer .closeBtn{flex:0 0 auto}
#mobileDrawer .drawerSection{display:none}
#mobileDrawer .drawerSection.active{display:block}
#settingsPanel .row{margin-top:8px}

/* Mobile detection */
@media (max-width: 1100px){
  #mobileMenuBtn{display:block}
}
@media (hover: none) and (pointer: coarse){
  #mobileMenuBtn{display:block}
}

/* ensure kifu panel is visible inside drawer on mobile */
#mobileDrawer #kifuPanel{display:block !important;margin:0 !important;width:100% !important;max-width:none !important;}
#mobileDrawer #kifuPanel .row{flex-wrap:wrap}
#mobileDrawer #kifuPanel textarea{min-height:180px;}

/* --- UX: last move highlight --- */
.cell.lastFrom{ box-shadow: inset 0 0 0 3px rgba(255,255,255,.55); }
.cell.lastTo{ box-shadow: inset 0 0 0 3px rgba(122,162,255,.95); }
.cell.lastFrom.lastTo{ box-shadow: inset 0 0 0 3px rgba(122,162,255,.95), inset 0 0 0 6px rgba(255,255,255,.35); }

/* --- Larger board on mobile --- */
@media (max-width: 980px){
  #gamePanel{ padding:10px !important; }
  #board{
    width: min(96vw, 560px);
    aspect-ratio: 1 / 1;
    margin: 0 auto;
    display: grid;
    grid-template-columns: repeat(9, 1fr);
    grid-template-rows: repeat(9, 1fr);
  }
  #board .cell{ width:auto !important; height:auto !important; }
  #board .piece{ font-size: clamp(18px, 4.8vw, 28px); }
  #board .coord{ font-size: clamp(9px, 2.2vw, 12px); }
}

/* --- UI Modal (no browser alert/confirm) --- */
#uiModal{display:none;position:fixed;inset:0;z-index:10000;background:rgba(0,0,0,.6)}
#uiModal .ui-modal-content{max-width:520px;margin:12vh auto 0;background:rgba(17,26,51,.98);border:1px solid rgba(255,255,255,.14);border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.45);padding:14px 14px 12px}
#uiModal #uiModalMsg{line-height:1.7}

/* --- AI result modal --- */
#aiResultModal{display:none;position:fixed;inset:0;z-index:10001;background:rgba(0,0,0,.65);padding:8px}
#aiResultModal .ai-content{max-width:860px;margin:6vh auto 0;background:rgba(17,26,51,.98);border:1px solid rgba(255,255,255,.14);border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.45);padding:16px;max-height:86vh;overflow:auto}
#aiResultBody{white-space:pre-wrap;word-break:break-word;overflow-wrap:anywhere}

#mobileDrawer .tabs .btn{flex:1}
#mobileDrawer .closeBtn{flex:0 0 auto}
#mobileDrawer .drawerSection{display:none}
#mobileDrawer .drawerSection.active{display:block}
#settingsPanel .row{margin-top:8px}

/* Mobile detection */
@media (max-width: 1100px){
  #mobileMenuBtn{display:block}
}
@media (hover: none) and (pointer: coarse){
  #mobileMenuBtn{display:block}
}

/* ensure kifu panel is visible inside drawer on mobile */
#mobileDrawer #kifuPanel{display:block !important;margin:0 !important;width:100% !important;max-width:none !important;}
#mobileDrawer #kifuPanel .row{flex-wrap:wrap}
#mobileDrawer #kifuPanel textarea{min-height:180px;}

/* --- UX: last move highlight --- */
.cell.lastFrom{ box-shadow: inset 0 0 0 3px rgba(255,255,255,.55); }
.cell.lastTo{ box-shadow: inset 0 0 0 3px rgba(122,162,255,.95); }
.cell.lastFrom.lastTo{ box-shadow: inset 0 0 0 3px rgba(122,162,255,.95), inset 0 0 0 6px rgba(255,255,255,.35); }

@media (max-width: 980px){
  /* reduce card padding a bit to give the board more real estate */
  #gamePanel{ padding:10px !important; }
  /* force the board to use viewport width */
  #board{
    width: min(96vw, 560px);
    aspect-ratio: 1 / 1;
    margin: 0 auto;
    display: grid;
    grid-template-columns: repeat(9, 1fr);
    grid-template-rows: repeat(9, 1fr);
  }
  /* make cells stretch with the board */
  #board .cell{
    width: auto !important;
    height: auto !important;
  }
  #board .piece{
    font-size: clamp(18px, 4.8vw, 28px);
  }
  #board .coord{
    font-size: clamp(9px, 2.2vw, 12px);
  }
}

/* --- UI Modal (alert/confirm replacement) --- */
#uiModal{display:none;position:fixed;inset:0;z-index:10000;background:rgba(0,0,0,.6)}
#uiModal .uiModalContent{max-width:520px;margin:12vh auto 0;background:rgba(17,26,51,.98);border:1px solid rgba(255,255,255,.14);border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.45);padding:14px 14px 12px}

/* --- AI Result Modal --- */
#aiResultModal{display:none;position:fixed;inset:0;z-index:10001;background:rgba(0,0,0,.65);padding:8px}
#aiResultModal .ai-content{max-width:860px;margin:6vh auto 0;background:rgba(17,26,51,.98);border:1px solid rgba(255,255,255,.14);border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.45);padding:16px;max-height:86vh;overflow:auto}

/* AI text wrapping */
#aiResultBody, .ai-text, .ai-pre{
  white-space: pre-wrap;
  line-height: 1.6;
  word-break: break-word;
  overflow-wrap: anywhere;
  text-overflow: clip;
}


/* ===== Desktop layout: board(left) + chat(right) / kifu under board ===== */
@media (min-width: 1101px){
  /* Prevent page scroll, but allow panels to manage their own overflow if needed */
  body{ overflow:hidden; }

  /* Expand wrap to full width on desktop */
  .wrap{ max-width:none; }

  /* Two-column grid: left=game+kifu, right=chat */
  .wrap{
    display:grid;
    grid-template-columns: minmax(760px, 1fr) 420px;
    grid-template-rows: auto minmax(260px, 1fr);
    grid-template-areas:
      "game chat"
      "kifu chat";
    gap: 14px;
    height: 100vh;
    align-items: stretch;
  }

  #gamePanel{ grid-area: game; overflow:auto; display:flex; flex-direction:column; }
  #kifuPanel{ grid-area: kifu; overflow:hidden; }
  #chatPanel{ grid-area: chat; overflow:hidden; display:flex; flex-direction:column; }

  /* Chat log scroll only */
  #chatPanel .chatLog{ flex:1; min-height:0; overflow:auto; }

  /* Board sizing: fit within available vertical space (avoid clipping) */
  #board{
    width: min(56vh, 720px);
    max-width: 100%;
    margin: 10px auto 0;
  }

  /* --- Desktop: keep holdings visible (sticky) --- */
  #gamePanel{ scroll-padding-top: 120px; scroll-padding-bottom: 140px; }
  #gamePanel > .hand{
    position: sticky;
    top: 0;
    z-index: 5;
    background: rgba(17,26,51,.92);
    backdrop-filter: blur(6px);
    padding-top: 10px;
  }
  #gamePanel .hands{
    position: sticky;
    bottom: 0;
    z-index: 5;
    background: rgba(17,26,51,.92);
    backdrop-filter: blur(6px);
    padding-bottom: 10px;
    margin-top: 10px;
  }

  /* --- Kifu header: title(left) + nav(right) --- */
  #kifuPanel .kifuHeader{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:6px; }
  #kifuPanel .kifuHeader h1{ margin:0; }
  #kifuPanel .kifuNav{ display:flex; align-items:center; gap:8px; flex:0 0 auto; }
  #kifuPanel .kifuNav .btn{ padding:.55rem .85rem; border-radius:999px; }
  #kifuPanel .kifuNav #kifuStep{ white-space:nowrap; opacity:.9; }

}
